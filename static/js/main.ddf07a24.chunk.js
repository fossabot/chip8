(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,,function(e,t,a){e.exports=a(26)},,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var i=a(0),r=a.n(i),n=a(7),s=a.n(n),o=(a(15),a(1)),c=a(2),l=a(4),h=a(3),u=a(5);a(16);function d(e){return 4095&e}function m(e){return 255&e}function y(e){return 15&e}function v(e){return(3840&e)>>8}function f(e){return(240&e)>>4}var p=[240,144,144,144,240,32,96,32,32,112,240,16,240,128,240,240,16,240,16,240,144,144,240,16,16,240,128,240,16,240,240,128,240,144,240,240,16,32,64,64,240,144,240,144,240,240,144,240,16,240,240,144,240,144,144,224,144,224,144,224,240,128,128,128,240,224,144,144,144,224,240,128,240,128,240,240,128,240,128,128],k=function(){function e(t){Object(o.a)(this,e),t=t||{},this.MEM_SIZE=t.memSize||4096,this.PC_START=t.pcStart||512,this.STACK_SIZE=t.stackSize||16,this.DISPLAY_SIZE=t.displaySize||2048,this.screen={draw:function(e){}},this.reset()}return Object(c.a)(e,[{key:"reset",value:function(){var e=this;this.memory=new Uint8Array(this.MEM_SIZE),p.forEach(function(t,a){e.memory[a]=t}),this.V=new Uint8Array(16),this.I=0,this.DT=0,this.ST=0,this.PC=this.PC_START,this.SP=0,this.stack=new Uint16Array(this.STACK_SIZE),this.display=new Array(this.DISPLAY_SIZE).fill(0),this.keys={},this.waitingKey=!1,this.waitingKeyTarget=-1,this.screen.draw(this.display)}},{key:"pressKey",value:function(e){this.keys[15&e]=!0,this.waitingKey&&(this.V[this.waitingKeyTarget]=e,this.waitingKey=!1)}},{key:"releaseKey",value:function(e){this.keys[15&e]=!1}},{key:"delayTimerTick",value:function(){this.DT>0&&(this.DT-=1)}},{key:"soundTimerTick",value:function(){this.ST>0&&(this.ST-=1),this.ST&&console.log("Stop sound!")}},{key:"writeWord",value:function(e,t){return this.writeByte(e,t>>8&255),this.writeByte(e+1,255&t),this}},{key:"writeByte",value:function(e,t){this.memory[e]=t}},{key:"cycle",value:function(){if(!this.waitingKey){var e=this.memory[this.PC]<<8|this.memory[this.PC+1];this.executeOpCode(e),this.shouldDraw&&(this.shouldDraw=!1,this.screen.draw(this.display))}}},{key:"throwInvalidOpCode",value:function(e){throw new Error("Invalid instruction opCode=".concat(e.toString(16)))}},{key:"executeOpCode",value:function(e){switch(this.PC+=2,(61440&e)>>12){case 0:return void this.opCodeFamily_0x0(e);case 1:return void this.opCodeFamily_0x1(e);case 2:return void this.opCodeFamily_0x2(e);case 3:return void this.opCodeFamily_0x3(e);case 4:return void this.opCodeFamily_0x4(e);case 5:return void this.opCodeFamily_0x5(e);case 6:return void this.opCodeFamily_0x6(e);case 7:return void this.opCodeFamily_0x7(e);case 8:return void this.opCodeFamily_0x8(e);case 9:return void this.opCodeFamily_0x9(e);case 10:return void this.opCodeFamily_0xA(e);case 11:return void this.opCodeFamily_0xB(e);case 12:return void this.opCodeFamily_0xC(e);case 13:return void this.opCodeFamily_0xD(e);case 14:return void this.opCodeFamily_0xE(e);case 15:return void this.opCodeFamily_0xF(e);default:return void this.throwInvalidOpCode(e)}}},{key:"opCodeFamily_0x0",value:function(e){switch(e){case 224:this.display.fill(0);break;case 238:this.SP-=1,this.PC=this.stack[this.SP]}}},{key:"opCodeFamily_0x1",value:function(e){var t=d(e);this.PC=t}},{key:"opCodeFamily_0x2",value:function(e){var t=d(e);this.stack[this.SP]=this.PC,this.SP+=1,this.PC=t}},{key:"opCodeFamily_0x3",value:function(e){var t=v(e),a=m(e);this.V[t]===a&&(this.PC+=2)}},{key:"opCodeFamily_0x4",value:function(e){var t=v(e),a=m(e);this.V[t]!==a&&(this.PC+=2)}},{key:"opCodeFamily_0x5",value:function(e){var t=v(e),a=f(e);0!==y(e)&&this.throwInvalidOpCode(e),this.V[t]===this.V[a]&&(this.PC+=2)}},{key:"opCodeFamily_0x6",value:function(e){var t=v(e),a=m(e);this.V[t]=a}},{key:"opCodeFamily_0x7",value:function(e){var t=v(e),a=m(e);this.V[t]=this.V[t]+a&255}},{key:"opCodeFamily_0x8",value:function(e){var t=y(e),a=v(e),i=f(e);switch(t){case 0:this.V[a]=this.V[i];break;case 1:this.V[a]=this.V[a]|this.V[i];break;case 2:this.V[a]=this.V[a]&this.V[i];break;case 3:this.V[a]=this.V[a]^this.V[i];break;case 4:var r=this.V[a]+this.V[i];this.V[15]=r>255,this.V[a]=255&r;break;case 5:var n=this.V[a]-this.V[i];this.V[15]=this.V[a]>=this.V[i],this.V[a]=255&n;break;case 6:this.V[15]=1&this.V[i],this.V[a]=this.V[i]=this.V[i]>>1;break;case 7:var s=this.V[i]-this.V[a];this.V[15]=this.V[i]>=this.V[a],this.V[a]=255&s;break;case 14:this.V[15]=(128&this.V[i])>>7,this.V[a]=this.V[i]=this.V[i]<<1;break;default:return void this.throwInvalidOpCode(e)}}},{key:"opCodeFamily_0x9",value:function(e){var t=v(e),a=f(e);0!==y(e)&&this.throwInvalidOpCode(e),this.V[t]!==this.V[a]&&(this.PC+=2)}},{key:"opCodeFamily_0xA",value:function(e){var t=d(e);this.I=t}},{key:"opCodeFamily_0xB",value:function(e){var t=d(e);this.PC=t+this.V[0]}},{key:"opCodeFamily_0xC",value:function(e){var t=v(e),a=m(e);this.V[t]=256*Math.random()&a}},{key:"opCodeFamily_0xD",value:function(e){var t=v(e),a=f(e),i=y(e);this.shouldDraw=!0,this.V[15]=0;for(var r=0;r<i;r++)for(var n=this.memory[this.I+r],s=0;s<8;s++){if(n&128>>s){var o=(this.V[t]+s)%64+64*((this.V[a]+r)%32);0!==this.display[o]&&(this.V[15]=1),this.display[o]^=1}}}},{key:"opCodeFamily_0xE",value:function(e){var t=v(e);switch(m(e)){case 158:var a=this.V[t];this.keys[a]&&(this.PC+=2);break;case 161:var i=this.V[t];this.keys[i]||(this.PC+=2);break;default:return void this.throwInvalidOpCode(e)}}},{key:"opCodeFamily_0xF",value:function(e){var t=v(e);switch(m(e)){case 7:this.V[t]=this.DT;break;case 10:this.waitingKey=!0,this.waitingKeyTarget=t;break;case 21:this.DT=this.V[t];break;case 24:this.ST=this.V[t];break;case 30:this.I=this.I+this.V[t]&65535;break;case 41:this.I=5*(15&this.V[t]);break;case 51:this.memory[this.I]=Math.floor(this.V[t]/100)%10,this.memory[this.I+1]=Math.floor(this.V[t]/10)%10,this.memory[this.I+2]=this.V[t]%10;break;case 85:for(var a=0;a<=t;a++)this.memory[this.I]=this.V[a],this.I=this.I+1&65535;break;case 101:for(var i=0;i<=t;i++)this.V[i]=this.memory[this.I],this.I=this.I+1&65535;break;default:return void this.throwInvalidOpCode(e)}}}]),e}(),C=(a(17),function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(h.a)(t).call(this,e))).containerRef=r.a.createRef(),a.canvasRef=r.a.createRef(),a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"resizeCanvas",value:function(){var e=this.containerRef.current.offsetWidth,t=this.containerRef.current.offsetHeight,a=Math.floor(Math.min(e/64,t/32));this.canvasWidth=this.canvasRef.current.width=64*a,this.canvasHeight=this.canvasRef.current.height=32*a}},{key:"draw",value:function(){var e=getComputedStyle(document.documentElement);this.drawColor=e.getPropertyValue("--main-color"),this.shadowColor="rgba(".concat(e.getPropertyValue("--main-color-rgb"),", ").concat(.4*Math.random(),")"),this.backgroundColor=e.getPropertyValue("--main-bg-color"),this.shadowBlur=20*Math.random(),this.ctx.fillStyle=this.backgroundColor,this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight);var t=this.canvasHeight/32;this.ctx.fillStyle=this.drawColor;for(var a=this.props.displayData,i=0;i<a.length;i++){var r=Math.floor(i/64),n=i%64;if(0!==a[i]){var s=n*t,o=r*t;this.ctx.shadowBlur=this.shadowBlur,this.ctx.shadowColor=this.shadowColor,this.ctx.fillRect(s,o,t,t)}}this.requestFrameId=window.requestAnimationFrame(this.draw.bind(this))}},{key:"componentDidMount",value:function(){this.ctx=this.canvasRef.current.getContext("2d"),this.canvasWidth=this.canvasRef.current.width,this.canvasHeight=this.canvasRef.current.height,this.resizeCanvas(),this.requestFrameId=window.requestAnimationFrame(this.draw.bind(this)),window.addEventListener("resize",this.resizeCanvas.bind(this))}},{key:"componentWillUnmount",value:function(){window.cancelAnimationFrame(this.requestFrameId),window.removeEventListener("resize",this.resizeCanvas.bind(this))}},{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){return r.a.createElement("div",{ref:this.containerRef,className:"ScreenContainer"},r.a.createElement("canvas",{ref:this.canvasRef,className:"ScreenCanvas"}))}}]),t}(r.a.Component));C.defaultProps={displayData:new Array(2048).fill(0)};var w=C,V=(a(18),function(e,t){return void 0===t&&(t=1),e.toString(16).padStart(2*t,"0").toUpperCase()}),b=function(e){return r.a.createElement("li",{className:"Word"},r.a.createElement("label",{className:"Label","data-testid":"label"},e.label),void 0!==e.old?r.a.createElement("span",{className:"Old","data-testid":"old"},V(e.old,e.bytes)):null,r.a.createElement("span",{className:"Current","data-testid":"current"},V(e.current,e.bytes)))};b.defaultProps={current:0,bytes:1};var S=r.a.memo(b),E=(a(19),function(e){return r.a.createElement("section",{className:"VRegisters"},r.a.createElement("h1",{"data-testid":"title"},"V Registers"),r.a.createElement("ul",{className:"RegistersList","data-testid":"registers-list"},Array.from(e.current).map(function(t,a){var i=e.old[a];return r.a.createElement(S,{key:a,label:"V".concat(a.toString(16).toUpperCase()),old:i,current:t})})))});E.defaultProps={current:[],old:[]};var P=E,g=(a(20),function(e){var t=e.old,a=e.current;return r.a.createElement("section",{id:"stack",className:"Stack"},r.a.createElement("h1",{"data-testid":"title"},"Stack"),r.a.createElement(S,{label:"SP",old:t.SP,current:a.SP,bytes:1,"data-testid":"sp"}),r.a.createElement("ul",{className:"StackList","data-testid":"stack-list"},Array.from(a.stack).map(function(e,a){var i=t.stack[a];return r.a.createElement(S,{key:a,label:"SP".concat(a.toString(16).toUpperCase()),bytes:2,old:i,current:e})})))});g.defaultProps={old:{SP:0,stack:[]},current:{SP:0,stack:[]}};var I=g,T=(a(21),function(e){var t=e.old,a=e.current;return r.a.createElement("section",{className:"Memory"},r.a.createElement("h1",{"data-testid":"title"},"Memory"),r.a.createElement("ul",{className:"MemoryList","data-testid":"memory-list"},r.a.createElement(S,{label:"PC ",old:t.PC,current:a.PC,bytes:2}),Array.from(a.memorySlice).map(function(e,t){return r.a.createElement(S,{key:t,label:V(t+a.PC,2),current:e})})))});T.defaultProps={old:{PC:0,memorySlice:[]},current:{PC:0,memorySlice:[]}};var x=T,R=(a(22),function(e){var t=e.old,a=e.current;return r.a.createElement("section",{className:"OtherRegisters"},r.a.createElement("h1",{"data-testid":"title"},"Other Registers"),r.a.createElement("ul",{className:"OtherRegistersList"},r.a.createElement(S,{label:"I",old:t.I,current:a.I,bytes:2}),r.a.createElement(S,{label:"DT",old:t.DT,current:a.DT,bytes:1}),r.a.createElement(S,{label:"ST",old:t.ST,current:a.ST,bytes:1})))});R.defaultProps={old:{I:0,DT:0,ST:0},current:{I:0,DT:0,ST:0}};var F=R,_=(a(23),a(24),function(e){return r.a.createElement("div",{role:"button","aria-label":e.children,className:"Button",onClick:e.onClick,tabIndex:"0"},e.children)}),O=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(h.a)(t).call(this,e))).onPlayClick=function(){a.props.onPlay(a.state.rom)},a.onLoadRom=function(){a.inputRef.current.click()},a.onFileChange=function(e){e.preventDefault();var t=e.target.files[0];if(t){var i=new FileReader;i.onload=function(e){var i=e.target.result;a.setState({fileName:t.name,rom:new Uint8Array(i)}),a.inputRef.current.blur()},i.readAsArrayBuffer(t)}},a.inputRef=r.a.createRef(),a.state={playing:!1,fileName:null,rom:null},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"playButton",value:function(){if(this.state.rom){var e=this.state.playing?"Reset":"Start";return r.a.createElement(_,{onClick:this.onPlayClick},e)}}},{key:"selectRom",value:function(){return this.state.rom?r.a.createElement("span",{className:"RomFileName",onClick:this.onLoadRom},this.state.fileName):r.a.createElement(_,{onClick:this.onLoadRom},"Load ROM")}},{key:"render",value:function(){return r.a.createElement("div",{className:"SelectROM"},r.a.createElement("input",{ref:this.inputRef,type:"file",onChange:this.onFileChange,className:"SelectROMInput"}),this.playButton(),this.selectRom())}}]),t}(r.a.Component),A=a(8),D=(a(25),{1:1,2:2,3:3,4:12,q:4,w:5,e:6,r:13,a:7,s:8,d:9,f:14,z:10,x:0,c:11,v:15}),N=[1,2,3,12,4,5,6,13,7,8,9,14,10,0,11,15],K=function(e){var t=Object(i.useState)({}),a=Object(A.a)(t,2),n=a[0],s=a[1],o=function(t,a){var i=D[t],r=Object.assign({},n);r[i]=a,s(r),a?e.onKeydown(i):e.onKeyup(i)},c=function(e){return o(e.key,!0)},l=function(e){return o(e.key,!1)};return Object(i.useEffect)(function(){return document.addEventListener("keydown",c),document.addEventListener("keyup",l),function(){document.removeEventListener("keydown",c),document.removeEventListener("keyup",l)}}),r.a.createElement("section",null,r.a.createElement("h1",null,"Keypad"),r.a.createElement("span",{className:"Keypad"},N.map(function(e){return r.a.createElement("div",{key:e,className:"Key "+(!0===n[e]?"PressedKey":"")},e.toString(16).toUpperCase())})))},j=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(h.a)(t).call(this,e))).onPlay=function(e){a.intervalHandle&&clearInterval(a.intervalHandle),a.chip8.reset();var t=512;e.forEach(function(e){a.chip8.writeByte(t,e),t++});var i=performance.now();a.intervalHandle=setInterval(function(){var e=performance.now();console.log("Last interval was ".concat(e-i," milliseconds ago")),i=e;var t=a.cyclesPerTick;do{a.chip8.cycle(),t--}while(t>0);a.chip8.soundTimerTick(),a.chip8.delayTimerTick(),setTimeout(function(){a.setState({displayData:a.chip8.display,otherRegisters:{old:a.state.otherRegisters.current,current:{I:a.chip8.I,DT:a.chip8.DT,ST:a.chip8.ST}},V:{old:a.state.V.current,current:a.chip8.V},stack:{old:a.state.stack.current,current:{SP:a.chip8.SP,stack:a.chip8.stack}},memory:{old:a.state.memory.current,current:{PC:a.chip8.PC,memorySlice:a.memorySlice(a.chip8.PC,a.chip8.memory)}}})},0)},1e3/60)},a.onKeydown=function(e){a.chip8.pressKey(e)},a.onKeyup=function(e){a.chip8.releaseKey(e)},a.state={displayData:new Array(0).fill(0),otherRegisters:{old:{I:0,DT:0,ST:0},current:{I:0,DT:0,ST:0}},V:{old:new Uint8Array(16).fill(0),current:new Uint8Array(16).fill(0)},stack:{old:{SP:0,stack:new Uint16Array(16)},current:{SP:0,stack:new Uint16Array(16)}},memory:{old:{PC:512,memorySlice:new Uint8Array(7)},current:{PC:512,memorySlice:new Uint8Array(7)}}},a.myRef=r.a.createRef(),a.intervalHandle=null,a.cyclesPerTick=10,a.chip8=new k,a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"memorySlice",value:function(e,t){return t.slice(e,e+7)}},{key:"render",value:function(){var e=this.state.otherRegisters,t=this.state.V,a=this.state.stack,i=this.state.memory;return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"Header"},r.a.createElement("h1",null,"Chip-8"),r.a.createElement(O,{onPlay:this.onPlay})),r.a.createElement("main",{className:"DisplayView"},r.a.createElement(w,{displayData:this.state.displayData})),r.a.createElement("section",{className:"MemoryView"},r.a.createElement(K,{onKeydown:this.onKeydown,onKeyup:this.onKeyup}),r.a.createElement(F,{old:e.old,current:e.current}),r.a.createElement(P,{old:t.old,current:t.current}),r.a.createElement(I,{old:a.old,current:a.current}),r.a.createElement(x,{old:i.old,current:i.current})))}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(j,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}],[[9,1,2]]]);
//# sourceMappingURL=main.ddf07a24.chunk.js.map