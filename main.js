!function(t){var i={};function e(r){if(i[r])return i[r].exports;var s=i[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,e),s.l=!0,s.exports}e.m=t,e.c=i,e.d=function(t,i,r){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(r,s,function(i){return t[i]}.bind(null,s));return r},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=0)}([function(t,i,e){"use strict";function r(t){return 4095&t}function s(t){return 255&t}function a(t){return 15&t}function o(t){return(3840&t)>>8}function n(t){return(240&t)>>4}e.r(i);var h=[240,144,144,144,240,32,96,32,32,112,240,16,240,128,240,240,16,240,16,240,144,144,240,16,16,240,128,240,16,240,240,128,240,144,240,240,16,32,64,64,240,144,240,144,240,240,144,240,16,240,240,144,240,144,144,224,144,224,144,224,240,128,128,128,240,224,144,144,144,224,240,128,240,128,240,240,128,240,128,128];function c(t,i){for(var e=0;e<i.length;e++){var r=i[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var l=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),i=i||{},this.MEM_SIZE=i.memSize||4096,this.PC_START=i.pcStart||512,this.STACK_SIZE=i.stackSize||16,this.DISPLAY_SIZE=i.displaySize||2048,this.screen={draw:function(t){}},this.reset()}var i,e,l;return i=t,(e=[{key:"reset",value:function(){var t=this;this.memory=new Uint8Array(this.MEM_SIZE),h.forEach(function(i,e){t.memory[e]=i}),this.V=new Uint8Array(16),this.I=0,this.DT=0,this.ST=0,this.PC=this.PC_START,this.SP=0,this.stack=new Uint16Array(this.STACK_SIZE),this.display=new Array(this.DISPLAY_SIZE).fill(0),this.keys={},this.waitingKey=!1,this.waitingKeyTarget=-1,this.screen.draw(this.display)}},{key:"pressKey",value:function(t){this.keys[15&t]=!0,this.waitingKey&&(this.V[this.waitingKeyTarget]=t,this.waitingKey=!1)}},{key:"releaseKey",value:function(t){this.keys[15&t]=!1}},{key:"writeWord",value:function(t,i){return this.writeByte(t,i>>8&255),this.writeByte(t+1,255&i),this}},{key:"writeByte",value:function(t,i){this.memory[t]=i}},{key:"cycle",value:function(){if(!this.waitingKey){var t=this.memory[this.PC]<<8|this.memory[this.PC+1];this.executeOpCode(t),this.shouldDraw&&(this.shouldDraw=!1,this.screen.draw(this.display))}}},{key:"throwInvalidOpCode",value:function(t){throw new Error("Invalid instruction opCode=".concat(t.toString(16)))}},{key:"executeOpCode",value:function(t){switch(this.PC+=2,(61440&t)>>12){case 0:return void this.opCodeFamily_0x0(t);case 1:return void this.opCodeFamily_0x1(t);case 2:return void this.opCodeFamily_0x2(t);case 3:return void this.opCodeFamily_0x3(t);case 4:return void this.opCodeFamily_0x4(t);case 5:return void this.opCodeFamily_0x5(t);case 6:return void this.opCodeFamily_0x6(t);case 7:return void this.opCodeFamily_0x7(t);case 8:return void this.opCodeFamily_0x8(t);case 9:return void this.opCodeFamily_0x9(t);case 10:return void this.opCodeFamily_0xA(t);case 11:return void this.opCodeFamily_0xB(t);case 12:return void this.opCodeFamily_0xC(t);case 13:return void this.opCodeFamily_0xD(t);case 14:return void this.opCodeFamily_0xE(t);case 15:return void this.opCodeFamily_0xF(t);default:return void this.throwInvalidOpCode(t)}}},{key:"opCodeFamily_0x0",value:function(t){switch(t){case 224:this.display.fill(0);break;case 238:this.SP-=1,this.PC=this.stack[this.SP]}}},{key:"opCodeFamily_0x1",value:function(t){var i=r(t);this.PC=i}},{key:"opCodeFamily_0x2",value:function(t){var i=r(t);this.stack[this.SP]=this.PC,this.SP+=1,this.PC=i}},{key:"opCodeFamily_0x3",value:function(t){var i=o(t),e=s(t);this.V[i]===e&&(this.PC+=2)}},{key:"opCodeFamily_0x4",value:function(t){var i=o(t),e=s(t);this.V[i]!==e&&(this.PC+=2)}},{key:"opCodeFamily_0x5",value:function(t){var i=o(t),e=n(t);0!==a(t)&&this.throwInvalidOpCode(t),this.V[i]===this.V[e]&&(this.PC+=2)}},{key:"opCodeFamily_0x6",value:function(t){var i=o(t),e=s(t);this.V[i]=e}},{key:"opCodeFamily_0x7",value:function(t){var i=o(t),e=s(t);this.V[i]=this.V[i]+e&255}},{key:"opCodeFamily_0x8",value:function(t){var i=a(t),e=o(t),r=n(t);switch(i){case 0:this.V[e]=this.V[r];break;case 1:this.V[e]=this.V[e]|this.V[r];break;case 2:this.V[e]=this.V[e]&this.V[r];break;case 3:this.V[e]=this.V[e]^this.V[r];break;case 4:var s=this.V[e]+this.V[r];this.V[15]=s>255,this.V[e]=255&s;break;case 5:var h=this.V[e]-this.V[r];this.V[15]=this.V[e]>=this.V[r],this.V[e]=255&h;break;case 6:this.V[15]=1&this.V[r],this.V[e]=this.V[r]=this.V[r]>>1;break;case 7:var c=this.V[r]-this.V[e];this.V[15]=this.V[r]>=this.V[e],this.V[e]=255&c;break;case 14:this.V[15]=(128&this.V[r])>>7,this.V[e]=this.V[r]=this.V[r]<<1;break;default:return void this.throwInvalidOpCode(t)}}},{key:"opCodeFamily_0x9",value:function(t){var i=o(t),e=n(t);0!==a(t)&&this.throwInvalidOpCode(t),this.V[i]!==this.V[e]&&(this.PC+=2)}},{key:"opCodeFamily_0xA",value:function(t){var i=r(t);this.I=i}},{key:"opCodeFamily_0xB",value:function(t){var i=r(t);this.PC=i+this.V[0]}},{key:"opCodeFamily_0xC",value:function(t){var i=o(t),e=s(t);this.V[i]=256*Math.random()&e}},{key:"opCodeFamily_0xD",value:function(t){var i=o(t),e=n(t),r=a(t);this.shouldDraw=!0,this.V[15]=0;for(var s=0;s<r;s++)for(var h=this.memory[this.I+s],c=0;c<8;c++){if(h&128>>c){var l=(this.V[i]+c)%64+64*((this.V[e]+s)%32);0!==this.display[l]&&(this.V[15]=1),this.display[l]^=1}}}},{key:"opCodeFamily_0xE",value:function(t){var i=o(t);switch(s(t)){case 158:var e=this.V[i];this.keys[e]&&(this.PC+=2);break;case 161:var r=this.V[i];this.keys[r]||(this.PC+=2);break;default:return void this.throwInvalidOpCode(t)}}},{key:"opCodeFamily_0xF",value:function(t){var i=o(t);switch(s(t)){case 7:this.V[i]=this.DT;break;case 10:this.waitingKey=!0,this.waitingKeyTarget=i;break;case 21:this.DT=this.V[i];break;case 24:this.ST=this.V[i];break;case 30:this.I=this.I+this.V[i]&65535;break;case 41:this.I=5*(15&this.V[i]);break;case 51:this.memory[this.I]=Math.floor(this.V[i]/100)%10,this.memory[this.I+1]=Math.floor(this.V[i]/10)%10,this.memory[this.I+2]=this.V[i]%10;break;case 85:for(var e=0;e<=i;e++)this.memory[this.I]=this.V[e],this.I=this.I+1&65535;break;case 101:for(var r=0;r<=i;r++)this.V[r]=this.memory[this.I],this.I=this.I+1&65535;break;default:return void this.throwInvalidOpCode(t)}}}])&&c(i.prototype,e),l&&c(i,l),t}();function u(t,i){for(var e=0;e<i.length;e++){var r=i[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var d,y,v=function(){function t(i,e){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.backgroundColor=e.backgroundColor||{r:40,g:40,b:40},this.drawColor=e.backgroundColor||{r:102,g:255,b:102},this.width=e.width||64,this.height=e.height||32,this.canvas=i,this.ctx=this.canvas.getContext("2d")}var i,e,r;return i=t,(e=[{key:"draw",value:function(t){var i=this.canvas.width,e=this.canvas.height,r=e/this.height;this.ctx.fillStyle="rgb(".concat(this.backgroundColor.r,",").concat(this.backgroundColor.g,",").concat(this.backgroundColor.b,")"),this.ctx.fillRect(0,0,i,e);for(var s="rgb(".concat(this.drawColor.r,",").concat(this.drawColor.g,",").concat(this.drawColor.b,")"),a=0;a<t.length;a++){var o=Math.floor(a/this.width),n=a%this.width;0!==t[a]&&this._drawPixel(n,o,r,s)}}},{key:"setBackGroundColor",value:function(t){this.backgroundColor=t}},{key:"setDrawColor",value:function(t){this.drawColor=t}},{key:"_drawPixel",value:function(t,i,e,r){this.ctx.fillStyle=r;var s=t*e,a=i*e;this.ctx.fillRect(s,a,e,e)}}])&&u(i.prototype,e),r&&u(i,r),t}(),f=[],C=new l;C.screen=new v(document.getElementById("screen")),C.screen.draw(C.display),document.querySelector("#start").addEventListener("click",function(){d&&(clearInterval(d),d=null),y&&(clearInterval(y),y=null),C.reset();var t=512;console.log("Rom size ".concat(f.length)),f.forEach(function(i){C.writeByte(t,i),t++}),d=setInterval(function(){C.cycle()},2),y=setInterval(function(){var t=C.DT-1;C.DT=t>0?t:0;var i=C.ST-1;C.ST=i>0?i:0},1/60)}),document.getElementById("file").addEventListener("change",function(t){var i=t.target.files[0],e=new FileReader;e.onload=function(t){var i=t.target.result;f=new Uint8Array(i)},e.readAsArrayBuffer(i)},!1)}]);
//# sourceMappingURL=main.js.map